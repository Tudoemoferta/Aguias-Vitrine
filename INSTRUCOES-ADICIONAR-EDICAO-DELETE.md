# üìù INSTRU√á√ïES - Adicionar Edi√ß√£o, Delete e Pre√ßo Anterior

## üéØ O QUE VAMOS ADICIONAR:

1. ‚úèÔ∏è **Bot√£o de Editar** em cada produto
2. üóëÔ∏è **Bot√£o de Deletar** em cada produto
3. üí∞ **Pre√ßo Anterior** (riscado) nos cards
4. üìù **Campo de Pre√ßo Anterior** no formul√°rio

---

## üìç PASSO 1: ATUALIZAR O BANCO DE DADOS

Abra o **SQL Editor do Supabase** e execute:

```sql
-- Adicionar coluna de pre√ßo anterior
ALTER TABLE products 
ADD COLUMN IF NOT EXISTS previous_price TEXT;

-- Adicionar pol√≠tica de DELETE
CREATE POLICY "Permitir exclus√£o p√∫blica" ON products
    FOR DELETE
    USING (true);
```

---

## üìç PASSO 2: ADICIONAR ESTILOS CSS

**ONDE:** Dentro da tag `<style>`, **ANTES** de `@media (max-width: 768px)`

**ADICIONE:**

```css
        /* Pre√ßo Anterior */
        .product-previous-price {
            font-size: 1.2rem;
            color: #999;
            text-decoration: line-through;
            margin-bottom: 0.5rem;
        }

        /* Bot√µes de A√ß√£o no Card */
        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-edit,
        .btn-delete {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #4CAF50;
            color: white;
        }

        .btn-edit:hover {
            background: #45a049;
        }

        .btn-delete {
            background: #f44336;
            color: white;
        }

        .btn-delete:hover {
            background: #da190b;
        }

        /* Modo de Edi√ß√£o */
        .editing-mode {
            background: #fff3cd !important;
            border: 3px solid #ffc107 !important;
        }
```

---

## üìç PASSO 3: ADICIONAR CAMPO NO FORMUL√ÅRIO

**ONDE:** No formul√°rio de admin, **DEPOIS** do campo "Pre√ßo" e **ANTES** do campo "Plataforma"

**ADICIONE:**

```html
                <div class="form-group">
                    <label>Pre√ßo Anterior (Opcional):</label>
                    <input type="text" id="productPreviousPrice" placeholder="Ex: R$ 199,90 (deixe vazio se n√£o houver)">
                </div>
```

---

## üìç PASSO 4: ATUALIZAR A FUN√á√ÉO displayProducts()

**ONDE:** Procure a fun√ß√£o `displayProducts()` no JavaScript

**SUBSTITUA** a parte que cria os cards (dentro do `.map()`) por:

```javascript
                filtered.map(product => `
                    <div class="product-card" id="product-${product.id}">
                        <div class="product-badges">
                            ${product.platform ? `<span class="badge badge-platform">${product.platform}</span>` : ''}
                            ${product.category ? `<span class="badge badge-category">${getCategoryName(product.category)}</span>` : ''}
                        </div>
                        <img src="${product.image}" alt="${product.name}" class="product-image" 
                             onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 400 300%22><rect fill=%22%23667eea%22 width=%22400%22 height=%22300%22/><text x=%2250%%22 y=%2250%%22 fill=%22white%22 font-size=%2224%22 text-anchor=%22middle%22>ü¶Ö</text></svg>'">
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            ${product.previous_price ? `<div class="product-previous-price">${product.previous_price}</div>` : ''}
                            <div class="product-price">${product.price}</div>
                            <a href="${product.link}" target="_blank" class="product-link">
                                <i class="fas fa-shopping-cart"></i> Ver Oferta
                            </a>
                            <div class="product-actions">
                                <button class="btn-edit" onclick="editProduct(${product.id})">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button class="btn-delete" onclick="deleteProduct(${product.id})">
                                    <i class="fas fa-trash"></i> Deletar
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')
```

---

## üìç PASSO 5: ATUALIZAR A FUN√á√ÉO addProduct()

**ONDE:** Procure a fun√ß√£o `addProduct()` no JavaScript

**SUBSTITUA** a parte que cria `newProduct` por:

```javascript
            const newProduct = {
                name: name,
                price: price,
                link: link,
                image: image,
                platform: platform,
                category: category,
                previous_price: document.getElementById('productPreviousPrice').value.trim() || null,
                created_at: new Date().toISOString()
            };
```

**E ADICIONE** esta linha na parte de limpar campos (depois de `uploadedImageData = null;`):

```javascript
                document.getElementById('productPreviousPrice').value = '';
```

---

## üìç PASSO 6: ADICIONAR NOVAS FUN√á√ïES

**ONDE:** No final do JavaScript, **ANTES** de `loadProducts();`

**ADICIONE:**

```javascript
        // Vari√°vel global para controlar edi√ß√£o
        let editingProductId = null;

        // Editar produto
        async function editProduct(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            // Abrir modal
            openAdminModal();
            
            // Fazer login autom√°tico se necess√°rio
            document.getElementById('adminForm').style.display = 'block';
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('adminPassword').parentElement.style.display = 'none';

            // Preencher campos
            document.getElementById('productName').value = product.name;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productPreviousPrice').value = product.previous_price || '';
            document.getElementById('productPlatform').value = product.platform || 'Shopee';
            document.getElementById('productCategory').value = product.category || 'outros';
            document.getElementById('productLink').value = product.link;
            document.getElementById('productImage').value = product.image;
            document.getElementById('productImage').style.display = 'block';

            // Mostrar preview da imagem
            document.getElementById('imagePreview').src = product.image;
            document.getElementById('imagePreview').style.display = 'block';

            // Mudar bot√£o para "Atualizar"
            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Atualizar Produto';
            submitBtn.onclick = function() { updateProduct(productId); };

            // Destacar card sendo editado
            editingProductId = productId;
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('editing-mode');
            });
            document.getElementById('product-' + productId)?.classList.add('editing-mode');

            // Scroll para o modal
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Atualizar produto
        async function updateProduct(productId) {
            const name = document.getElementById('productName').value.trim();
            const price = document.getElementById('productPrice').value.trim();
            const previousPrice = document.getElementById('productPreviousPrice').value.trim();
            const link = document.getElementById('productLink').value.trim();
            const platform = document.getElementById('productPlatform').value;
            const category = document.getElementById('productCategory').value;
            const imageUrl = document.getElementById('productImage').value.trim();
            const image = uploadedImageData || imageUrl;

            if (!name || !price || !link || !image) {
                alert('‚ö†Ô∏è Preencha todos os campos obrigat√≥rios!');
                return;
            }

            const updatedProduct = {
                name: name,
                price: price,
                previous_price: previousPrice || null,
                link: link,
                image: image,
                platform: platform,
                category: category
            };

            try {
                const { error } = await supabase
                    .from('products')
                    .update(updatedProduct)
                    .eq('id', productId);

                if (error) {
                    console.error('Erro ao atualizar:', error);
                    // Atualizar localmente
                    const index = allProducts.findIndex(p => p.id === productId);
                    if (index !== -1) {
                        allProducts[index] = { ...allProducts[index], ...updatedProduct };
                        saveToLocalStorage();
                    }
                    updateConnectionStatus(false);
                } else {
                    updateConnectionStatus(true);
                }

                // Recarregar produtos
                await loadProducts();

                // Limpar formul√°rio
                resetForm();
                closeAdminModal();
                
                alert('‚úÖ Produto atualizado com sucesso!');
            } catch (err) {
                console.error('Erro:', err);
                alert('‚ùå Erro ao atualizar produto!');
            }
        }

        // Deletar produto
        async function deleteProduct(productId) {
            if (!confirm('üóëÔ∏è Tem certeza que deseja deletar este produto?')) {
                return;
            }

            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productId);

                if (error) {
                    console.error('Erro ao deletar:', error);
                    // Deletar localmente
                    allProducts = allProducts.filter(p => p.id !== productId);
                    saveToLocalStorage();
                    updateConnectionStatus(false);
                } else {
                    updateConnectionStatus(true);
                }

                // Recarregar produtos
                await loadProducts();
                
                alert('‚úÖ Produto deletado com sucesso!');
            } catch (err) {
                console.error('Erro:', err);
                // Deletar localmente como fallback
                allProducts = allProducts.filter(p => p.id !== productId);
                saveToLocalStorage();
                displayProducts();
                alert('‚úÖ Produto deletado localmente!');
            }
        }

        // Resetar formul√°rio
        function resetForm() {
            document.getElementById('productName').value = '';
            document.getElementById('productPrice').value = '';
            document.getElementById('productPreviousPrice').value = '';
            document.getElementById('productLink').value = '';
            document.getElementById('productImage').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            uploadedImageData = null;
            editingProductId = null;

            // Restaurar bot√£o para "Adicionar"
            const submitBtn = document.querySelector('.btn-submit');
            submitBtn.innerHTML = '<i class="fas fa-plus"></i> Adicionar Produto';
            submitBtn.onclick = addProduct;

            // Remover destaque dos cards
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('editing-mode');
            });
        }
```

---

## üìç PASSO 7: ATUALIZAR closeAdminModal()

**ONDE:** Procure a fun√ß√£o `closeAdminModal()`

**SUBSTITUA** por:

```javascript
        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            resetForm();
        }
```

---

## ‚úÖ RESUMO DAS MUDAN√áAS:

| Local | O que fazer |
|-------|-------------|
| **SQL Supabase** | Adicionar coluna `previous_price` |
| **CSS** | Adicionar estilos dos bot√µes e pre√ßo anterior |
| **HTML Formul√°rio** | Adicionar campo "Pre√ßo Anterior" |
| **displayProducts()** | Adicionar bot√µes Editar/Deletar e pre√ßo anterior |
| **addProduct()** | Incluir campo `previous_price` |
| **Final do JS** | Adicionar fun√ß√µes: `editProduct()`, `updateProduct()`, `deleteProduct()`, `resetForm()` |
| **closeAdminModal()** | Chamar `resetForm()` |

---

## üéØ RESULTADO FINAL:

### **Card do Produto:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [Shopee] [üìö Livros]‚îÇ
‚îÇ                     ‚îÇ
‚îÇ   [IMAGEM]          ‚îÇ
‚îÇ                     ‚îÇ
‚îÇ Nome do Produto     ‚îÇ
‚îÇ R$ 199,90 (riscado) ‚îÇ ‚Üê Pre√ßo anterior
‚îÇ R$ 89,90           ‚îÇ ‚Üê Pre√ßo atual
‚îÇ [Ver Oferta]       ‚îÇ
‚îÇ [‚úèÔ∏è Editar] [üóëÔ∏è Del]‚îÇ ‚Üê Novos bot√µes
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üí° COMO USAR:

### **Editar:**
1. Clique em "‚úèÔ∏è Editar" no produto
2. Modal abre com campos preenchidos
3. Altere o que quiser
4. Clique em "Atualizar Produto"

### **Deletar:**
1. Clique em "üóëÔ∏è Deletar"
2. Confirme a exclus√£o
3. Produto √© removido

### **Pre√ßo Anterior:**
1. Ao adicionar/editar produto
2. Preencha "Pre√ßo Anterior" (opcional)
3. Aparecer√° riscado no card

---

## üö® IMPORTANTE:

- Fa√ßa backup do `index.html` atual antes de modificar
- Teste cada mudan√ßa separadamente
- Se der erro, me avise qual parte

---

**Quer que eu crie o arquivo completo j√° modificado? Ou prefere fazer manualmente seguindo estas instru√ß√µes?**

